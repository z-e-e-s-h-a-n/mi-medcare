"use client";

import { useMedias } from "@hooks/media";
import SearchToolbar from "@components/dashboard/SearchToolbar";
import { MediaGrid } from "./MediaGrid";
import Pagination from "@components/dashboard/Pagination";
import { useState } from "react";
import { Tabs, TabsList, TabsContent, TabsTrigger } from "@components/ui/tabs";
import { Library, Upload } from "lucide-react";
import MediaUploader from "./MediaUploader";

interface MediaLibraryProps {
  onSelect?: (media: MediaResponse) => void;
}

function MediaLibrary({ onSelect }: MediaLibraryProps) {
  const [page, setPage] = useState(1);
  const [limit, setLimit] = useState(10);
  const [search, setSearch] = useState("");
  const [searchBy, setSearchBy] =
    useState<MediaQueryType["searchBy"]>("filename");
  const [sortBy, setSortBy] = useState<MediaQueryType["sortBy"]>("createdAt");
  const [sortOrder, setSortOrder] = useState<"asc" | "desc">("desc");
  const [filter, setFilter] = useState<string>();

  const { data, isFetching } = useMedias({
    page,
    limit,
    search,
    searchBy,
    sortBy,
    sortOrder,
  });

  return (
    <Tabs asChild defaultValue="library">
      <section className="space-y-16">
        <div className="flex flex-col sm:flex-row items-center justify-between  gap-4">
          <TabsList className="bg-transparent gap-4 border w-1/2">
            <TabsTrigger value="upload">
              <Upload /> Upload
            </TabsTrigger>
            <TabsTrigger value="library">
              <Library /> Library
            </TabsTrigger>
          </TabsList>

          <SearchToolbar<MediaQueryType>
            search={search}
            setPage={setPage}
            setSearch={setSearch}
            searchBy={searchBy}
            setSearchBy={setSearchBy}
            sortBy={sortBy}
            setSortBy={setSortBy}
            sortOrder={sortOrder}
            filter={filter}
            setFilter={setFilter}
            setSortOrder={setSortOrder}
            searchByOptions={[
              { label: "Filename", value: "filename" },
              { label: "ID", value: "id" },
            ]}
          />
        </div>
        <TabsContent value="upload">
          <MediaUploader />
        </TabsContent>
        <TabsContent value="library" className="space-y-6">
          <MediaGrid
            medias={data?.medias ?? []}
            isFetching={isFetching}
            onSelect={onSelect}
          />
          {data && (
            <Pagination
              total={data.total}
              limit={limit}
              currentPage={page}
              totalPages={data.totalPages}
              setLimit={setLimit}
              setPage={setPage}
            />
          )}
        </TabsContent>
      </section>
    </Tabs>
  );
}

export default MediaLibrary;
